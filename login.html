<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Painel de Estudos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* ... (todo o CSS, sem mudanças) ... */
        :root {
            --primary-color: #ff4d8d; --primary-light: #ff85b2; --primary-dark: #e6005c;
            --background-color: #fff0f5; --card-color: #ffffff; --text-color: #4a4a4a;
            --border-color: #ffd6e7; --shadow-color: rgba(255, 77, 141, 0.2);
            --danger-color: #d23369; --success-color: #06d6a0; --info-color: #17a2b8;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Poppins', sans-serif; background-color: var(--background-color);
            color: var(--text-color); display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
            background-image: radial-gradient(circle at 10% 20%, rgba(255,214,231,0.3) 0%, rgba(255,214,231,0) 90%);
            overflow-x: hidden; 
        }
        .login-container {
            background-color: var(--card-color); padding: 40px; border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow-color); width: 90%; max-width: 450px;
            text-align: center; z-index: 10; position: relative; 
        }
        .login-container h1 { color: var(--primary-dark); margin-bottom: 10px; font-size: 2rem; }
        .login-container p.subtitle { margin-bottom: 30px; font-size: 1rem; color: #777; }
        .form-group { margin-bottom: 20px; text-align: left; position: relative; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--primary-dark); }
        .form-group input { 
            width: 100%; padding: 12px 15px; border: 2px solid var(--border-color);
            border-radius: 8px; font-size: 1rem; font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s; 
        }
        .input-with-icon input { padding-right: 45px; }
        .form-group input:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 77, 141, 0.2);
        }
        .input-with-icon { position: relative; }
        .input-with-icon .icon {
            position: absolute; top: 50%; right: 15px; transform: translateY(-50%);
            color: #ccc; cursor: pointer; z-index: 2;
        }
         .input-with-icon .icon.toggle-password:hover { color: var(--primary-color); }
        .submit-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer;
            font-size: 1.1rem; font-weight: 500; width: 100%; transition: all 0.3s;
            box-shadow: 0 4px 8px var(--shadow-color); text-transform: uppercase; letter-spacing: 1px;
            margin-top: 10px; display: flex; align-items: center; justify-content: center;
            gap: 10px; position: relative; min-height: 48px; 
        }
        .submit-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            box-shadow: 0 6px 12px var(--shadow-color); transform: translateY(-2px);
        }
        .submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #fff;
            width: 20px; height: 20px; animation: spin 1s ease-in-out infinite; display: none; 
        }
        .submit-btn.loading .spinner { display: inline-block; }
        .submit-btn.loading span { visibility: hidden; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .toggle-form { margin-top: 25px; font-size: 0.9rem; }
        .toggle-form a { color: var(--primary-color); font-weight: 500; text-decoration: none; cursor: pointer; }
        .toggle-form a:hover { text-decoration: underline; }
        .message { padding: 10px; margin-bottom: 20px; border-radius: 5px; font-size: 0.9rem; display: none; }
        .message.error { background-color: rgba(210, 51, 105, 0.1); color: var(--danger-color); border: 1px solid var(--danger-color); }
        .message.success { background-color: rgba(6, 214, 160, 0.1); color: var(--success-color); border: 1px solid var(--success-color); }
        .password-rules {
            font-size: 0.8rem; color: #777; text-align: left;
            margin-top: 8px; margin-bottom: 15px; padding-left: 5px;
        }
        .password-rules ul { list-style: none; padding: 0;}
        .password-rules li { margin-bottom: 3px;}
        .password-rules li.valid { color: var(--success-color); }
        .password-rules li.valid::before { content: "✓ "; }
        .password-rules li.invalid { color: var(--danger-color); }
        .password-rules li.invalid::before { content: "✗ "; }
        .consent-group {
            margin-top: 15px; margin-bottom: 20px; text-align: left;
            font-size: 0.8rem; color: #555; display: flex; align-items: flex-start; 
        }
        .consent-group input[type="checkbox"] {
            margin-right: 8px; margin-top: 3px; transform: scale(1.2); 
            accent-color: var(--primary-color);
        }
        .consent-group label { font-weight: normal; color: #555; }
    </style>
</head>
<body>
    <div class="login-container">
        <form id="loginForm">
            <h1>Login</h1>
            <p class="subtitle">Acesse seu painel de estudos</p>
            <div id="loginMessage" class="message"></div>
            <div class="form-group">
                <label for="loginEmail">E-mail</label>
                <input type="email" id="loginEmail" placeholder="seuemail@exemplo.com" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">Senha</label>
                <div class="input-with-icon">
                    <input type="password" id="loginPassword" placeholder="Sua senha" required>
                    <i class="fas fa-eye icon toggle-password"></i>
                </div>
            </div>
            <button type="submit" class="submit-btn"><span>Entrar</span></button>
            <p class="toggle-form">Não tem uma conta? <a id="showRegister">Crie uma aqui</a></p>
        </form>

        <form id="registerForm" style="display: none;">
            <h1>Criar Conta</h1>
            <p class="subtitle">Preencha os campos para se registrar</p>
            <div id="registerMessage" class="message error" style="display:none;"></div>
            <div class="form-group">
                <label for="registerEmail">E-mail</label>
                <input type="email" id="registerEmail" placeholder="seuemail@exemplo.com" required>
            </div>
            <div class="form-group">
                <label for="registerPassword">Senha</label>
                 <div class="input-with-icon">
                    <input type="password" id="registerPassword" placeholder="Crie uma senha forte" required minlength="8" maxlength="12"> 
                    <i class="fas fa-eye icon toggle-password"></i>
                </div>
                <div class="password-rules">
                    <ul>
                        <li id="lengthRule">8-12 caracteres</li>
                        <li id="upperRule">Pelo menos 1 letra maiúscula</li>
                        <li id="digitRule">Pelo menos 2 algarismos</li>
                        <li id="symbolRule">Pelo menos 2 símbolos (@!$%&)</li>
                    </ul>
                </div>
            </div>
             <div class="form-group">
                <label for="confirmPassword">Confirmar Senha</label>
                 <div class="input-with-icon">
                    <input type="password" id="confirmPassword" placeholder="Repita a senha" required>
                     <i class="fas fa-eye icon toggle-password"></i>
                </div>
            </div>
            <div class="consent-group">
                <input type="checkbox" id="consentCheckbox" required>
                <label for="consentCheckbox">Declaro estar ciente de que este projeto foi desenvolvido por uma pessoa sem formação ou experiência profissional em programação, podendo, portanto, apresentar falhas ou limitações técnicas que não sejam possíveis de corrigir. Utilizo-o por minha livre e espontânea vontade, compreendendo sua natureza experimental e educativa.</label>
            </div>
            <button type="submit" class="submit-btn" id="registerSubmitBtn">
                <div class="spinner"></div>
                <span>Registrar</span>
            </button>
            <p class="toggle-form">Já tem uma conta? <a id="showLogin">Faça login aqui</a></p>
        </form>
    </div>
    <!-- O HTML do modal de sucesso foi omitido para encurtar, pois não há mudanças nele -->

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
        // ######### INÍCIO DA SEÇÃO DE CONFIGURAÇÃO DO FIREBASE #########
        const firebaseConfig = {
            apiKey: "AIzaSyD6msk2NG3gfyPKhjZJ4HB1X6SJ8ICzSMg",
            authDomain: "painel-de-controle-para-o-enem.firebaseapp.com",
            projectId: "painel-de-controle-para-o-enem",
            storageBucket: "painel-de-controle-para-o-enem.appspot.com", // CORRIGIDO
            messagingSenderId: "144604369875",
            appId: "1:144604369875:web:c113d74ba1b0ddd1629526",
            measurementId: "G-W7PM1J1FNN"
        };
        // ######### FIM DA SEÇÃO DE CONFIGURAÇÃO DO FIREBASE #########

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegisterLink = document.getElementById('showRegister');
        const showLoginLink = document.getElementById('showLogin');
        const loginMessage = document.getElementById('loginMessage');
        const registerErrorMessage = document.getElementById('registerMessage');
        const registerPasswordInput = document.getElementById('registerPassword');
        // O restante do JavaScript não precisa de mudanças
        document.querySelectorAll('.toggle-password').forEach(icon => {
            icon.addEventListener('click', function() {
                const input = this.previousElementSibling;
                input.type = (input.type === 'password') ? 'text' : 'password';
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
        });
        function displayMessage(element, messageText, type = 'error') {
            element.textContent = messageText;
            element.className = `message ${type}`;
            element.style.display = 'block';
        }
        function hideMessage(element) { if (element) element.style.display = 'none'; }
        function showLoading(button) { button.classList.add('loading'); button.disabled = true; }
        function hideLoading(button) { button.classList.remove('loading'); button.disabled = false; }
        showRegisterLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.style.display = 'none';
            hideMessage(loginMessage);
            registerForm.style.display = 'block';
            hideMessage(registerErrorMessage);
        });
        showLoginLink.addEventListener('click', (e) => {
            e.preventDefault();
            registerForm.style.display = 'none';
            hideMessage(registerErrorMessage);
            loginForm.style.display = 'block';
            hideMessage(loginMessage);
        });
        function validatePasswordRealtime() { 
            const pass = registerPasswordInput.value; let isValid = true;
            const lengthRule = document.getElementById('lengthRule');
            const upperRule = document.getElementById('upperRule');
            const digitRule = document.getElementById('digitRule');
            const symbolRule = document.getElementById('symbolRule');
            if (pass.length >= 8 && pass.length <= 12) { lengthRule.className = 'valid'; } else { lengthRule.className = 'invalid'; isValid = false; }
            if (/[A-Z]/.test(pass)) { upperRule.className = 'valid'; } else { upperRule.className = 'invalid'; isValid = false; }
            if ((pass.match(/\d/g) || []).length >= 2) { digitRule.className = 'valid'; } else { digitRule.className = 'invalid'; isValid = false; }
            if ((pass.match(/[@!$%&]/g) || []).length >= 2) { symbolRule.className = 'valid'; } else { symbolRule.className = 'invalid'; isValid = false; }
            return isValid;
        }
        if(registerPasswordInput) registerPasswordInput.addEventListener('input', validatePasswordRealtime);
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessage(registerErrorMessage);
            const consentCheckbox = document.getElementById('consentCheckbox'); 
            if (!consentCheckbox.checked) { 
                displayMessage(registerErrorMessage, "Você deve declarar estar ciente dos termos para se registrar.");
                return;
            }
            const email = document.getElementById('registerEmail').value;
            const password = registerPasswordInput.value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            if (!email || !document.getElementById('registerEmail').checkValidity()) { 
                displayMessage(registerErrorMessage, "Por favor, insira um endereço de e-mail válido."); return;
            }
            if (!validatePasswordRealtime()) {
                displayMessage(registerErrorMessage, "Por favor, corrija os erros no formato da senha."); return;
            }
            if (password !== confirmPassword) {
                displayMessage(registerErrorMessage, "As senhas não coincidem."); return;
            }
            const registerSubmitBtn = document.getElementById('registerSubmitBtn');
            showLoading(registerSubmitBtn); 
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                await db.collection("users").doc(user.uid).set({
                    email: user.email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                await user.sendEmailVerification();
                registerForm.reset();
                // Lógica do modal de sucesso omitida para encurtar
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') {
                    displayMessage(registerErrorMessage, "Este endereço de e-mail já está em uso.");
                } else {
                    displayMessage(registerErrorMessage, "Erro ao registrar: " + error.message);
                }
            } finally {
                hideLoading(registerSubmitBtn); 
            }
        });
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessage(loginMessage);
            const loginSubmitBtn = loginForm.querySelector('.submit-btn');
            showLoading(loginSubmitBtn);
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            if (!email || !password) {
                displayMessage(loginMessage, "Por favor, preencha e-mail e senha.");
                hideLoading(loginSubmitBtn);
                return;
            }
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                if (!user.emailVerified) {
                    displayMessage(loginMessage, "Seu e-mail ainda não foi verificado. Por favor, clique no link enviado para seu e-mail.", "info");
                    hideLoading(loginSubmitBtn);
                    return; 
                }
                sessionStorage.setItem('loggedInFirebaseUserUID', user.uid);
                sessionStorage.setItem('loggedInUserDisplay', user.email); 
                window.location.href = 'index.html';
            } catch (error) {
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    displayMessage(loginMessage, "E-mail ou senha inválidos.");
                } else {
                    displayMessage(loginMessage, "Erro ao fazer login: " + error.message);
                }
            } finally {
                hideLoading(loginSubmitBtn);
            }
        });
    </script>
</body>
</html>
